<ion-view>
  <ion-nav-title>{{currentBottle ? 'Messages in bottle' : 'Fish for a bottle!'}}</ion-nav-title>
  <ion-nav-buttons side="right">
    <button class="button button-clear button-light" ng-click="showTrail()">
      <i class="fa fa-paper-plane"></i> View Trail
    </button>
  </ion-nav-buttons>
  <ion-content class="padding page-grab">
    <div ng-if="!currentBottle">
      <a class="button button-block button-positive button-normal" data-ng-click="grabBottle()">
        GRAB!
      </a>
    </div>
    <div ng-if="currentBottle" class="list list-inset">
      <div class="card">
        <div class="item item-divider">
          {{currentBottle.author}}
        </div>
        <div class="item item-text-wrap">
          {{currentBottle.message}}
        </div>
      </div>
      <div class="card" data-ng-repeat="message in currentBottle.messages">
        <div class="item item-divider">
          {{message.author}}
        </div>
        <div class="item item-text-wrap">
          {{message.message}}
        </div>
      </div>

      <form name="replyBottleForm" data-ng-submit="replyBottle(replyBottleForm)" novalidate>
        <div class="card">
          <label class="item card-top" data-ng-class="{ 'has-error' : replyBottleForm.message.$invalid}">
            <textarea name="message" class="message-textarea col col-100" type="textarea" placeholder="Write your message here!" ng-model="newMessageData.message" required>
            </textarea>
          </label>
          
          <div class="form-errors" data-ng-show="replyBottleForm.message.$error && replyBottleForm.message.$touched || replyBottleForm.$submitted" data-ng-messages="replyBottleForm.message.$error">
            <div data-ng-messages-include="templates/form-errors.html">
            </div>
          </div>

          <ion-toggle ng-model="locationEnable" toggle-class="toggle-calm">
            <span>
              <i class="fa fa-location-arrow" ng-class="{true : 'bright-marker'}[locationEnable]"></i>
              {{ locationEnable ? 'Location added!' : 'Add message location!' }}
            </span>
          </ion-toggle>
          
          <label class="item card-bottom" data-ng-class="{ 'has-error' : replyBottleForm.author.$invalid}">
            <input name="author" class="message-author-signature" type="text" placeholder="Sign it with a creative name!" ng-model="newMessageData.author" required />
          </label>
          
          <div class="form-errors" data-ng-show="replyBottleForm.author.$error && replyBottleForm.author.$touched || replyBottleForm.$submitted"
               data-ng-messages="replyBottleForm.author.$error">
            <div data-ng-messages-include="templates/form-errors.html">
            </div>
          </div>

          <div class="grab-row">
            <div class="grab-col-50">
              <button class="button button-block button-positive button-normal" id="button-other-bottle" data-ng-click="releaseBottle()">
                Get another bottle!
              </button>
            </div>

            <div class="grab-col-50">
              <button class="button button-block button-positive button-normal" id="button-reply" type="submit">
                <!-- <img src="/images/main/bottle.svg" /> -->
                <span>Reply</span>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </ion-content>
</ion-view>
